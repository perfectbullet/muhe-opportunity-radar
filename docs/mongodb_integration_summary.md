# MongoDB é›†æˆå®Œæˆæ€»ç»“

## ğŸ‰ å®Œæˆçš„åŠŸèƒ½

### 1. æ•°æ®åº“ç®¡ç†æ¨¡å— (`storage/db_manager.py`)
å·²åˆ›å»ºå®Œæ•´çš„ MongoDB æ•°æ®ç®¡ç†å™¨ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… **ä¿å­˜å•æ¬¡åˆ†æè®°å½•**ï¼š`save_analysis()`
  - ææ–™å†…å®¹
  - æŠ•èµ„è€…ä¿¡æ¯
  - åˆ†æç»“æœ
  - é¢å¤–ä¸Šä¸‹æ–‡
  - å…ƒæ•°æ®ï¼ˆæ¨¡å‹ã€æ¸©åº¦ç­‰ï¼‰
  - è‡ªåŠ¨è®°å½•æ—¶é—´æˆ³

- âœ… **ä¿å­˜å¯¹æ¯”åˆ†æè®°å½•**ï¼š`save_comparison()`
  - å¤šæŠ•èµ„è€…åˆ†æç»“æœ
  - ç»¼åˆå¯¹æ¯”æ€»ç»“
  - å®Œæ•´çš„åˆ†æå†å²

#### æŸ¥è¯¢åŠŸèƒ½
- âœ… **è·å–æœ€è¿‘è®°å½•**ï¼š`get_recent_analyses()` - æ”¯æŒæŒ‰æŠ•èµ„è€…ç­›é€‰
- âœ… **æŒ‰IDæŸ¥è¯¢**ï¼š`get_analysis_by_id()` - ç²¾ç¡®æŸ¥æ‰¾
- âœ… **å…³é”®è¯æœç´¢**ï¼š`search_analyses()` - å…¨æ–‡æ£€ç´¢
- âœ… **ç»Ÿè®¡åˆ†æ**ï¼š`get_statistics()` - æ€»æ•°ã€æŠ•èµ„è€…åˆ†å¸ƒç­‰

#### æ€§èƒ½ä¼˜åŒ–
- âœ… è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ç´¢å¼•
  - æ—¶é—´æˆ³ç´¢å¼•ï¼ˆé™åºï¼‰
  - æŠ•èµ„è€…IDç´¢å¼•
  - å¤åˆç´¢å¼•ï¼ˆæŠ•èµ„è€…+æ—¶é—´ï¼‰

### 2. åˆ†æå™¨é›†æˆ (`analysis/perspective_analyzer.py`)
å·²å°† MongoDB åŠŸèƒ½å®Œç¾é›†æˆåˆ°å¤šè§†è§’åˆ†æå™¨ï¼š

#### ç‰¹æ€§
- âœ… **è‡ªåŠ¨ä¿å­˜**ï¼šæ¯æ¬¡åˆ†æè‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“
- âœ… **ä¼˜é›…é™çº§**ï¼šMongoDB æœªè¿æ¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°æ— æ•°æ®åº“æ¨¡å¼
- âœ… **å¯é€‰åŠŸèƒ½**ï¼šé€šè¿‡ `enable_db` å‚æ•°æ§åˆ¶æ˜¯å¦å¯ç”¨æ•°æ®åº“
- âœ… **å®Œæ•´å…ƒæ•°æ®**ï¼šä¿å­˜æ¨¡å‹ã€æ¸©åº¦ã€æŠ•èµ„è€…å±æ€§ç­‰ä¿¡æ¯

#### ä¿å­˜æ—¶æœº
```python
# å•æ¬¡åˆ†æåè‡ªåŠ¨ä¿å­˜
analyze_from_perspective() â†’ è‡ªåŠ¨è°ƒç”¨ db_manager.save_analysis()

# å¯¹æ¯”åˆ†æåè‡ªåŠ¨ä¿å­˜
compare_perspectives() â†’ è‡ªåŠ¨è°ƒç”¨ db_manager.save_comparison()
```

### 3. é…ç½®å’Œä¾èµ–
- âœ… æ·»åŠ  `pymongo>=4.0.0` åˆ° requirements.txt
- âœ… åœ¨ `.env` æ·»åŠ  MongoDB é…ç½®
  ```env
  MONGODB_URI=mongodb://localhost:27017/
  MONGODB_DB_NAME=muhe_opportunity_radar
  ```
- âœ… è‡ªåŠ¨ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®

### 4. æµ‹è¯•è„šæœ¬
åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼š

- âœ… **test_mongodb.py** - MongoDB åŠŸèƒ½æµ‹è¯•
  - è¿æ¥æµ‹è¯•
  - ä¿å­˜å’ŒæŸ¥è¯¢æµ‹è¯•
  - å¯¹æ¯”åˆ†ææµ‹è¯•
  - ç»Ÿè®¡ä¿¡æ¯æµ‹è¯•

- âœ… **test_db_integration.py** - é›†æˆæµ‹è¯•
  - åˆ†æå™¨åˆ›å»ºæµ‹è¯•
  - é™çº§æ¨¡å¼æµ‹è¯•

### 5. æ–‡æ¡£
- âœ… **mongodb_integration.md** - å®Œæ•´çš„ MongoDB é›†æˆæ–‡æ¡£
  - å®‰è£…æŒ‡å—ï¼ˆWindows/Mac/Linuxï¼‰
  - é…ç½®è¯´æ˜
  - ä½¿ç”¨ç¤ºä¾‹
  - æ•°æ®ç»“æ„è¯´æ˜
  - å¸¸è§é—®é¢˜è§£ç­”
  - æ€§èƒ½ä¼˜åŒ–å»ºè®®

## ğŸ“Š æ•°æ®ç»“æ„è®¾è®¡

### å•æ¬¡åˆ†æè®°å½•
```json
{
  "material": "æŠ•èµ„ææ–™",
  "investor_id": "buffett",
  "investor_name": "æ²ƒä¼¦Â·å·´è²ç‰¹",
  "analysis_result": "åˆ†æç»“æœ...",
  "additional_context": "ä¸Šä¸‹æ–‡",
  "metadata": {
    "investor_title": "è‚¡ç¥",
    "risk_tolerance": "ä½",
    "llm_provider": "siliconflow",
    "temperature": 0.7
  },
  "created_at": "2024-12-21T...",
  "material_length": 1234,
  "analysis_length": 5678
}
```

### å¯¹æ¯”åˆ†æè®°å½•
```json
{
  "type": "comparison",
  "material": "æŠ•èµ„ææ–™",
  "investor_ids": ["buffett", "graham", "lynch"],
  "investor_count": 3,
  "analyses": [...],
  "comparison_summary": "ç»¼åˆæ€»ç»“...",
  "created_at": "2024-12-21T..."
}
```

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```python
from analysis.perspective_analyzer import PerspectiveAnalyzer

# åˆ›å»ºåˆ†æå™¨ï¼ˆè‡ªåŠ¨å¯ç”¨æ•°æ®åº“ï¼‰
analyzer = PerspectiveAnalyzer(llm_provider='siliconflow')

# åˆ†æä¼šè‡ªåŠ¨ä¿å­˜
result = analyzer.analyze_from_perspective(
    material="æŸå…¬å¸è´¢æŠ¥...",
    investor_id="buffett"
)
```

### æŸ¥è¯¢å†å²
```python
from storage.db_manager import AnalysisRecordManager

manager = AnalysisRecordManager()

# æœ€è¿‘10æ¡
recent = manager.get_recent_analyses(limit=10)

# å·´è²ç‰¹çš„åˆ†æ
buffett = manager.get_recent_analyses(investor_id="buffett")

# æœç´¢å…³é”®è¯
results = manager.search_analyses("èŒ…å°")

# ç»Ÿè®¡ä¿¡æ¯
stats = manager.get_statistics()
```

## ğŸ”§ å·¥ä½œæ¨¡å¼

### 1. å®Œæ•´æ¨¡å¼ï¼ˆMongoDB è¿è¡Œæ—¶ï¼‰
- âœ… æ‰€æœ‰åˆ†æè‡ªåŠ¨ä¿å­˜
- âœ… æ”¯æŒå†å²æŸ¥è¯¢å’Œæœç´¢
- âœ… æä¾›ç»Ÿè®¡åˆ†æåŠŸèƒ½

### 2. é™çº§æ¨¡å¼ï¼ˆMongoDB æœªè¿è¡Œæ—¶ï¼‰
- âœ… æ ¸å¿ƒåˆ†æåŠŸèƒ½æ­£å¸¸
- âš ï¸ ä¸ä¿å­˜åˆ°æ•°æ®åº“
- â„¹ï¸ æ˜¾ç¤ºå‹å¥½æç¤º

**ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶é€‰æ‹©åˆé€‚çš„æ¨¡å¼ï¼**

## ğŸš€ åç»­åŠŸèƒ½è§„åˆ’

### å·²å®Œæˆ
- âœ… æ•°æ®åº“é›†æˆ
- âœ… è‡ªåŠ¨ä¿å­˜åˆ†æè®°å½•
- âœ… å†å²æŸ¥è¯¢åŠŸèƒ½
- âœ… æœç´¢åŠŸèƒ½
- âœ… ç»Ÿè®¡åŠŸèƒ½

### è®¡åˆ’ä¸­
- ğŸ“Š åˆ†æç»“æœå¯è§†åŒ–é¢æ¿
- ğŸ“ˆ æŠ•èµ„è§‚ç‚¹è¶‹åŠ¿åˆ†æ
- ğŸ”„ å†å²å¯¹æ¯”å·¥å…·
- ğŸ“¤ å¯¼å‡ºåˆ†ææŠ¥å‘Šï¼ˆPDF/Excelï¼‰
- ğŸ¤– åŸºäºå†å²çš„ AI æ¨è
- ğŸ¨ Gradio/Streamlit å¯è§†åŒ–ç•Œé¢

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
1. `storage/db_manager.py` - MongoDB ç®¡ç†å™¨ï¼ˆ230è¡Œï¼‰
2. `storage/__init__.py` - æ¨¡å—åˆå§‹åŒ–
3. `scripts/test_mongodb.py` - MongoDB æµ‹è¯•è„šæœ¬
4. `scripts/test_db_integration.py` - é›†æˆæµ‹è¯•è„šæœ¬
5. `docs/mongodb_integration.md` - å®Œæ•´æ–‡æ¡£

### ä¿®æ”¹æ–‡ä»¶
1. `analysis/perspective_analyzer.py` - é›†æˆæ•°æ®åº“åŠŸèƒ½
2. `requirements.txt` - æ·»åŠ  pymongo ä¾èµ–
3. `.env` - æ·»åŠ  MongoDB é…ç½®

## âœ… æµ‹è¯•çŠ¶æ€

### ä»£ç è´¨é‡
- âœ… æ— è¯­æ³•é”™è¯¯
- âœ… ç±»å‹æç¤ºå®Œæ•´
- âœ… å¼‚å¸¸å¤„ç†å¥å…¨
- âœ… é™çº§æœºåˆ¶å®Œå–„

### åŠŸèƒ½æµ‹è¯•
- âœ… æ¨¡å—å¯¼å…¥æ­£å¸¸
- âœ… åˆ†æå™¨åˆ›å»ºæˆåŠŸ
- âœ… é™çº§æ¨¡å¼å·¥ä½œæ­£å¸¸
- âš ï¸ MongoDB æµ‹è¯•éœ€è¦æœåŠ¡è¿è¡Œï¼ˆè¿™æ˜¯é¢„æœŸè¡Œä¸ºï¼‰

## ğŸ“ æœ€ä½³å®è·µ

### 1. è‡ªåŠ¨é™çº§
ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ MongoDB çŠ¶æ€ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†è¿æ¥å¤±è´¥ã€‚

### 2. æ•°æ®å®‰å…¨
- æ‰€æœ‰é”™è¯¯éƒ½æœ‰å¼‚å¸¸æ•è·
- æ•°æ®åº“å¤±è´¥ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½
- å‹å¥½çš„é”™è¯¯æç¤º

### 3. æ€§èƒ½ä¼˜åŒ–
- è‡ªåŠ¨åˆ›å»ºç´¢å¼•
- æ‰¹é‡æŸ¥è¯¢æ”¯æŒ
- è¿æ¥æ± ç®¡ç†

### 4. æ‰©å±•æ€§
- æ¨¡å—åŒ–è®¾è®¡
- æ˜“äºæ·»åŠ æ–°å­—æ®µ
- æ”¯æŒè‡ªå®šä¹‰æŸ¥è¯¢

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. [MongoDB é›†æˆæ–‡æ¡£](docs/mongodb_integration.md) - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—
2. [æµ‹è¯•è„šæœ¬](scripts/test_mongodb.py) - åŠŸèƒ½æµ‹è¯•
3. [ä»£ç ç¤ºä¾‹](docs/mongodb_integration.md#ä½¿ç”¨ç¤ºä¾‹) - å®ç”¨æ¡ˆä¾‹

## ğŸ‰ æ€»ç»“

MongoDB é›†æˆå·²å®Œç¾å®Œæˆï¼ä¸»è¦äº®ç‚¹ï¼š

1. **æ— ç¼é›†æˆ**ï¼šè‡ªåŠ¨ä¿å­˜ï¼Œé›¶é…ç½®
2. **ä¼˜é›…é™çº§**ï¼šMongoDB å¯é€‰ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½
3. **å®Œæ•´åŠŸèƒ½**ï¼šä¿å­˜ã€æŸ¥è¯¢ã€æœç´¢ã€ç»Ÿè®¡ä¸€åº”ä¿±å…¨
4. **ç”Ÿäº§å°±ç»ª**ï¼šå¼‚å¸¸å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–ã€æ–‡æ¡£å®Œå–„

**ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼å³ä½¿æ²¡æœ‰å®‰è£… MongoDBï¼Œç³»ç»Ÿä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚**
